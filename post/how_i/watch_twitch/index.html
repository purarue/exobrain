<!doctype html><html lang="en"><title>exobrain | How I watch Twitch</title><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control"content="no-cache, no-store, must-revalidate"><link rel="shortcut icon"href="/assets/img/logo.png"type="image/png"><meta http-equiv="Pragma"content="no-cache"><meta http-equiv="Expires"content="0"><link rel="stylesheet"href="/assets/style.css"><header class="nav-bar"><nav><a class="homelink"href="/">exobrain</a><div class="nav-right"><div class="nav-item"><a class="nav-link"href="/search">[search]</a></div><div class="nav-item"><a class="nav-link"href="/feed">[feed]</a></div><div class="nav-item"><a class="nav-link"href="/sitemap">[sitemap]</a></div><div class="nav-item"><a class="nav-link"href="https://sean.fish">back to my site</a></div></div></nav></header><main><div class="container"><div id="main-header"><div class="h1"id="main-title">How I watch Twitch</div><div class="title-date">2020/06/13</div></div><p>Running the heavy <a href="https://twitch.tv">Twitch</a> Web UI lags my computer considerably, so I prefer not to use it.<p>For interacting with chat, I use <a href="https://chatterino.com/">chatterino</a>, which handles that part completely.<p>For streaming video, the core of it all depends on <a href="https://github.com/ytdl-org/youtube-dl/"><code>youtube-dl</code></a>, which handles grabbing the URLs to stream from. <a href="https://mpv.io"><code>mpv</code></a> has a good interop and can make calls out to <code>youtube-dl</code>. So the easiest way to do this - with no configuration - would be to install <code>mpv</code> and <code>youtube-dl</code>, and then run:<p><code>mpv https://twitch.tv/&lt;username&gt;</code><p>However, that gives you no control over the quality of the stream.<p>To get the format codes, you pass the <code>-F</code> flag to <code>youtube-dl</code>:<pre><code>$ youtube-dl -F &quot;https://twitch.tv/&lt;username&gt;&quot;
[twitch:stream] boxbox: Downloading access token JSON
[twitch:stream] 38881685: Downloading stream JSON
[twitch:stream] 38881685: Downloading m3u8 information
[info] Available formats for 38640062448:
format code       extension  resolution note
audio_only        mp4        audio only  165k , mp4a.40.2
160p              mp4        284x160     230k , avc1.4D401F, 30.0fps, mp4a.40.2
360p              mp4        640x360     630k , avc1.4D401F, 30.0fps, mp4a.40.2
480p              mp4        852x480    1434k , avc1.4D401F, 30.0fps, mp4a.40.2
720p              mp4        1280x720   2379k , avc1.4D401F, 30.0fps, mp4a.40.2
720p60            mp4        1280x720   3429k , avc1.4D401F, 60.0fps, mp4a.40.2
1080p60__source_  mp4        1920x1080  6909k , avc1.64002A, 60.0fps, mp4a.40.2 (best)</code></pre><p>The format code is the first column, so if you wanted to stream in <code>480p</code> to conserve bandwidth, you’d use <code>480p</code>, and pass that to <code>mpv</code> like:<pre><code>mpv &quot;https://twitch.tv/&lt;username&gt;&quot; --ytdl-format=&quot;480p&quot;</code></pre><p>Thats the basics. I have a couple wrapper scripts I use, so if you’re interested in those, keep reading.<p>I do this so often - picking a format code and using mpv to stream something, that I wrote <a href="https://gitlab.com/seanbreckenridge/mpvf/"><code>mpvf</code></a>. That takes a link, calls <code>youtube-dl -F</code> on it, prompts you to select one, and then streams that with <code>mpv</code>.<figure><img src="images/demo.gif"alt="example using fzf to prompt"><figcaption aria-hidden="true">example using fzf to prompt</figcaption></figure><p>I further wrapped <code>mpvf</code> into a script called <code>twitch</code>, which:<ul><li>accepts the name of a twitch streamer as the first argument<li>opens chatterino if its not already open<li>prompts me to select a format and starts streaming in the background.</ul><pre><code>#!/bin/sh
# open chatterino and use mpv to stream from twitch
STREAMER=&quot;${1:?&#39;Pass the twitch user to stream from as the first argument.&#39;}&quot;
export MPVF_PICKER=rofi
pgrep -x chatterino &gt;/dev/null || chatterino &amp;
setsid mpvf &quot;https://www.twitch.tv/${STREAMER}&quot; &amp;</code></pre><p>The <code>setsid</code> is to run <code>mpv</code> in a new session, to make sure that I don’t have to leave the terminal which I ran <code>twitch &lt;username&gt;</code> from open, that can be closed once <code>mpv</code> starts running. Run <code>man setsid</code> for more info.<p>All of this streaming from command line is sort of useless if I still have to open the Twitch website to see if someone is online, so I wrote <a href="https://gitlab.com/seanbreckenridge/twitchlive/">twitchlive</a> to be able to see which streamers I’m following are online. Its a bit annoying to set up due to how the twitch API is aimed towards web and not CLI applications, but it works well:<pre><code>twitchlive -output-format=table
+---------------+--------+--------------+-------------------------------------+
|     USER      | UPTIME | VIEWER COUNT |            STREAM TITLE             |
+---------------+--------+--------------+-------------------------------------+
| nl_Kripp      | 05:27  |        14683 | Chill BG Night | Twitter            |
|               |        |              | @Kripparrian                        |
| sodapoppin    | 06:42  |        14003 | serkfgjhlbnlsebfoldtghnodilurngudrg |
| LilyPichu     | 04:01  |         7676 | hhiiiii                             |
| Mizkif        | 08:47  |         6742 | YO GET IN HERE                      |
| Trainwreckstv | 00:49  |         3337 | recap + ban appeals | !twitter      |
|               |        |              | | !podcast                          |
| Greekgodx     | 07:34  |         2868 | @Greekgodx on Twitter               |
| SirhcEz       | 01:44  |         1430 | SINGEEDDDDDD | SirhcEz cafe &amp;       |
|               |        |              | chill | #LeaguePartner              |
+---------------+--------+--------------+-------------------------------------+</code></pre><p>The two commands could even be combined like:<pre><code>twitchlive -output-format json | jq -r &#39;.[] | .username&#39; | fzf | xargs twitch</code></pre><p>… which uses <code>twitchlive</code> to get a list of currently live channels, prompting me to select one with <code>fzf</code>, and then passing that on to the <code>twitch</code> script to start watching them.</div></main><footer><p><a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode"id="copyright">© 2020 Sean Breckenridge. Licensed under Creative Commons Attribution-ShareAlike.</a><br><a href="https://github.com/seanbreckenridge/exobrain">Source Code</a></footer><script src="/assets/main.js"></script>