<!doctype html><html lang="en"><title>exobrain | Bash Notes</title><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control"content="no-cache, no-store, must-revalidate"><link rel="shortcut icon"href="/assets/img/logo.png"type="image/png"><meta http-equiv="Pragma"content="no-cache"><meta http-equiv="Expires"content="0"><link rel="stylesheet"href="/assets/style.css"><header class="nav-bar"><nav><a class="homelink"href="/">exobrain</a><div class="nav-right"><div class="nav-item"><a class="nav-link"href="/feed">[feed]</a></div><div class="nav-item"><a class="nav-link"href="/sitemap">[sitemap]</a></div><div class="nav-item"><a class="nav-link"href="https://sean.fish">back to my site</a></div></div></nav></header><main><div class="container"><div id="main-header"><div class="h1"id="main-title">Bash Notes</div></div><p>Use bash substitutions when possible instead of <code>sed</code>/<code>awk</code>.<h4 id="ttyscripting">tty/scripting</h4><p>Its useful to check the response of the <code>tty</code> command when doing interactive scripts. I use it for my <a href="https://sean.fish/d/cross-platform/launch?dark"><code>launch</code></a> script. If I run <code>launch htop</code>. If I’m already in a terminal, it just launches <code>htop</code>, but if its being run from a keybind/in the background, it opens a new terminal and runs that as an argument.<p>As an example, to prompt me to select something:<div class="sourceCode"id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"aria-hidden="true"></a><span class="va">pick=</span><span class="st">&#39;fzf&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2"aria-hidden="true"></a><span class="co"># if run from rofi/i3, use picker instead</span></span>
<span id="cb1-3"><a href="#cb1-3"aria-hidden="true"></a><span class="kw">if [[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">tty</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">=</span> <span class="st">&quot;not a tty&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb1-4"><a href="#cb1-4"aria-hidden="true"></a>    <span class="co"># cross platform GUI picker https://sean.fish/d/picker?dark</span></span>
<span id="cb1-5"><a href="#cb1-5"aria-hidden="true"></a>    <span class="va">pick=</span><span class="st">&#39;picker&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6"aria-hidden="true"></a><span class="kw">fi</span></span>
<span id="cb1-7"><a href="#cb1-7"aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8"aria-hidden="true"></a><span class="co"># run some command, use the picker chosen, and copy what I chose to my clipboard</span></span>
<span id="cb1-9"><a href="#cb1-9"aria-hidden="true"></a><span class="ex">something</span> <span class="kw">|</span> <span class="st">&quot;</span><span class="va">$pick</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">clipcopy</span></span></code></pre></div><p>If I’m running using a keybind in the background, that would use <a href="https://github.com/davatorium/rofi"><code>rofi</code></a> (<code>picker</code>), If I’m running from a terminal, it’d use <a href="https://github.com/junegunn/fzf"><code>fzf</code></a><p>The <code>[[ "$(tty)" = "not a tty" ]]</code> is the important bit; that means this isn’t being run from a terminal. If it is, the result is something like:<div class="sourceCode"id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"aria-hidden="true"></a>$ <span class="ex">tty</span></span>
<span id="cb2-2"><a href="#cb2-2"aria-hidden="true"></a><span class="ex">/dev/pts/9</span></span></code></pre></div><h4 id="auto-expanding-variable-contents">Auto expanding variable contents:</h4><div class="sourceCode"id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"aria-hidden="true"></a><span class="co"># special syntax to expand \n to actual newline in string</span></span>
<span id="cb3-2"><a href="#cb3-2"aria-hidden="true"></a><span class="va">name=</span><span class="st">$&#39;Sean</span><span class="dt">\n</span><span class="st">Breckenridge&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3"aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$name</span><span class="st">&quot;</span> <span class="co"># receives one argument</span></span>
<span id="cb3-4"><a href="#cb3-4"aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5"aria-hidden="true"></a><span class="co"># weird printf trickery</span></span>
<span id="cb3-6"><a href="#cb3-6"aria-hidden="true"></a><span class="bu">printf</span> <span class="st">&quot;%s&quot;</span> <span class="va">$name</span> <span class="co"># auto expands to two arguments, only prints &#39;Sean&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7"aria-hidden="true"></a><span class="bu">printf</span> <span class="st">&quot;%s %s&quot;</span> <span class="va">$name</span> <span class="co"># printf receives two arguments</span></span>
<span id="cb3-8"><a href="#cb3-8"aria-hidden="true"></a></span>
<span id="cb3-9"><a href="#cb3-9"aria-hidden="true"></a><span class="co"># safest is to quote your variables</span></span>
<span id="cb3-10"><a href="#cb3-10"aria-hidden="true"></a><span class="bu">printf</span> <span class="st">&quot;%s&quot;</span> <span class="st">&quot;</span><span class="va">$name</span><span class="st">&quot;</span> </span></code></pre></div><hr><h4 id="modifying-ifs-to-read-into-arrays">Modifying IFS to read into arrays:</h4><p>You can use <code>$'\n'</code> to expand an actual newline into the internal field separator, and then use a subshell to split lines into an array:<div class="sourceCode"id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"aria-hidden="true"></a><span class="bu">declare</span> -a <span class="va">dircontents</span></span>
<span id="cb4-2"><a href="#cb4-2"aria-hidden="true"></a><span class="va">IFS=</span><span class="st">$&#39;</span><span class="dt">\n</span><span class="st">&#39;</span> <span class="va">dircontents=($(</span><span class="fu">ls</span> -1<span class="va">))</span></span>
<span id="cb4-3"><a href="#cb4-3"aria-hidden="true"></a><span class="kw">for</span> <span class="ex">val</span> in <span class="st">&quot;</span><span class="va">${dircontents[@]}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb4-4"><a href="#cb4-4"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;value: </span><span class="va">${val}</span><span class="st">&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5"aria-hidden="true"></a><span class="kw">done</span></span></code></pre></div><p>The default value for <code>IFS</code> is whitespace.<hr><p>Maybe look into <code>perl</code> instead of <code>sed</code>/<code>awk</code>/<code>tr</code>/<code>cut</code>, look at <code>perlre</code> and <code>perlrun</code> man pages.<p>Startup time for running a script is much more than using an exported function or alias, but it also makes it less portable. Despite there being a huge difference, to the human eye its typically not noticeable.<p>Read the bash man page! Bashisms can be bad if you’re trying to be POSIX compliant, but bashisms also save lots of time.<p>You may need to use POSIX complaint code for something like Solaris SVR4 packages which requires Bourne shell for any scripts.<h4 id="early-exit">Early Exit</h4><p>Print message to STDERR if value is unset and exit:<div class="sourceCode"id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"aria-hidden="true"></a><span class="co"># if $1 is unset/empty</span></span>
<span id="cb5-2"><a href="#cb5-2"aria-hidden="true"></a><span class="va">USER_INPUT=</span><span class="st">&quot;</span><span class="va">${1:?</span>must provide something as first argument<span class="va">}</span><span class="st">&quot;</span></span></code></pre></div><hr><p><code>2&gt;/dev/null 1&gt;&amp;2</code> to completely silence a script, <code>echo something &gt;&amp;2</code> (or <code>1&gt;&amp;2</code>) to print an error.<hr><h4 id="extensions">Extensions</h4><p><code>.sh</code> at the end of scripts is only necessary if you’re creating libraries, or if you’re for some reason in windows land. Otherwise you’re only making yourself do more typing. If you’re making libraries, there is no shebang line and there shouldn’t be - its meant to be <code>source</code>d into some other script. If its a library, it should have a <code>.sh</code> or <code>.bash</code> extension and the file shouldn’t be executable.<hr><p>Use short circuiting when doing simple tests, case statements for basic subcommands, and getopts if you want to have short and long (<code>-h</code>, <code>--help</code>) options for consistency/larger programs.<p>SUID/SGID are forbidden on shell scripts (running as owner as script instead of person executing the script). Too many security risks that come along with using that, use <code>sudo</code> if you need elevated access.<h4 id="stylingformatting">Styling/Formatting</h4><p>Notes from <a href="https://google.github.io/styleguide/shellguide.html">Google StyleGuide</a>:<p>Don’t need to use the <code>function</code> keyword, as its optional. Also, there aren’t really functions, they’re procedures/methods. No reason to break POSIX compliance and using <code>function</code>.<p>Using hyphens (or nothing) instead of underscores for variable/script names.<p>I tend to just use <a href="https://github.com/mvdan/sh"><code>shfmt</code></a> for everything.<p>HEREDOCs that have indentation need tabs, so it can make formatting confusing - so they need to left justified. You can use a dash to chomp tabs, but then it removes <em>all</em> surrounded tabs.<p>One can use embedded newlines:<div class="sourceCode"id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"aria-hidden="true"></a><span class="va">some_string=</span><span class="st">&quot;I am a string</span></span>
<span id="cb6-2"><a href="#cb6-2"aria-hidden="true"></a><span class="st">with multiple lines&quot;</span></span></code></pre></div><p>Don’t but <code>do</code> and <code>then</code> on their own line when using <code>for</code>/<code>if</code> loops:<div class="sourceCode"id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"aria-hidden="true"></a><span class="kw">for</span> <span class="ex">....</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb7-2"><a href="#cb7-2"aria-hidden="true"></a>  <span class="ex">expression</span></span>
<span id="cb7-3"><a href="#cb7-3"aria-hidden="true"></a><span class="kw">done</span></span>
<span id="cb7-4"><a href="#cb7-4"aria-hidden="true"></a><span class="kw">if</span> <span class="ex">....</span><span class="kw">;</span> <span class="kw">then</span></span>
<span id="cb7-5"><a href="#cb7-5"aria-hidden="true"></a>  <span class="ex">expression</span></span>
<span id="cb7-6"><a href="#cb7-6"aria-hidden="true"></a><span class="kw">done</span></span></code></pre></div><p>Using semicolons makes the indent more obvious.<p>When doing <em>lots</em> of parameter expansion when doing an echo, would make more sense to separate that into another variable, or use <code>printf</code>. Avoid stuff like:<div class="sourceCode"id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${1}</span><span class="st">0</span><span class="va">${2}</span><span class="st">0</span><span class="va">${3}</span><span class="st">&quot;</span></span></code></pre></div><p>Quoting:<ul><li><em>Always quote your strings!</em> Often better to ‘over-quote’ than to get an error with shell expansion.<li>Never quote literal integers<li>Use <code>"$@"</code> unless you have a specific reason to use <code>$*</code>, like splatting in the individual elements into a string: <code>"search?q=$*"</code><li>Single quotes doesn’t do any shell substitution.<li>Always do shell expansion</ul><p>It may not be necessary, but always quote your command substitutions to be safe:<div class="sourceCode"id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"aria-hidden="true"></a><span class="va">some_val=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">subshell</span> command <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span></code></pre></div><p><code>readonly</code> is a synonym for <code>declare -r</code>, which makes a variable constant.<div class="sourceCode"id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"aria-hidden="true"></a><span class="va">FLAGS=(</span> --foo --bar<span class="va">=</span><span class="st">&#39;baz&#39;</span> <span class="va">)</span></span>
<span id="cb10-2"><a href="#cb10-2"aria-hidden="true"></a><span class="bu">readonly</span> <span class="va">FLAGS</span></span></code></pre></div><p>Don’t need to quote variables in arithmetic subshells<div class="sourceCode"id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"aria-hidden="true"></a><span class="kw">if</span> <span class="kw">((</span> <span class="va">$#</span> &gt; 3 <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb11-2"><a href="#cb11-2"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;too many arguments&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3"aria-hidden="true"></a><span class="kw">fi</span></span></code></pre></div><p>Don’t need to quote literal integers, but you may want to single quote words:<div class="sourceCode"id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"aria-hidden="true"></a><span class="va">exit_code=</span>3</span>
<span id="cb12-2"><a href="#cb12-2"aria-hidden="true"></a><span class="va">some_value=</span><span class="st">&#39;true&#39;</span></span></code></pre></div><p>Use <code>$(command)</code> instead of back ticks. Nested back ticks require escaping the inner ones. <code>$(command)</code> doesn’t change and is easier to read:<div class="sourceCode"id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"aria-hidden="true"></a><span class="co"># Do:</span></span>
<span id="cb13-2"><a href="#cb13-2"aria-hidden="true"></a><span class="va">var=</span><span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span><span class="va">)</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3"aria-hidden="true"></a><span class="co"># instead of:</span></span>
<span id="cb13-4"><a href="#cb13-4"aria-hidden="true"></a><span class="va">var=</span><span class="st">&quot;</span><span class="kw">`</span><span class="bu">command</span> <span class="dt">\`</span>command<span class="dt">\`</span><span class="kw">`</span><span class="st">&quot;</span></span></code></pre></div><p>Use <code>[[ ... ]]</code> instead of <code>[ ... ]</code>, <code>test</code> and <code>/usr/bin/[</code> to avoid POSIX issues. <code>[[ ]]</code> is <strong>built-in</strong> to bash, doing <code>[</code> causes you to do a subshell out to the <code>[</code> command, and offers you the advantage that:<p><code>[[ ... ]]</code> reduces errors as no pathname expansion or word splitting takes place. To exemplify what that means, you can do <code>[[ $VAR == test ]]</code>, without worrying about <code>$VAR</code> expanding to multiple words. You can still do <code>"$VAR"</code>, but its not required.<p>This also means when you’re doing regex, you can splat a variable into a regex to test against a string:<pre><code>[[ $filename =~ ^[[:alnum:]]+$pattern ]]</code></pre><p>For regex:<div class="sourceCode"id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"aria-hidden="true"></a><span class="co"># this matches</span></span>
<span id="cb15-2"><a href="#cb15-2"aria-hidden="true"></a><span class="kw">[[</span> <span class="st">&quot;filename&quot;</span> <span class="ot">==</span> f*<span class="kw"> ]]</span></span>
<span id="cb15-3"><a href="#cb15-3"aria-hidden="true"></a><span class="co"># this doesnt</span></span>
<span id="cb15-4"><a href="#cb15-4"aria-hidden="true"></a><span class="kw">[[</span> <span class="st">&quot;filename&quot;</span> <span class="ot">==</span> <span class="st">&quot;f*&quot;</span><span class="kw"> ]]</span></span></code></pre></div><p>Bash is smart enough to deal with empty strings in test. (<code>/usr/bin/[</code> is not!)<p>Use <code>-z</code> to empty strings, and <code>-n</code> to test if strings has value:<div class="sourceCode"id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"aria-hidden="true"></a><span class="kw">[[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw"> ]]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;argument is empty&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2"aria-hidden="true"></a><span class="kw">[[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw"> ]]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;argument has value: </span><span class="va">${1}</span><span class="st">&quot;</span></span></code></pre></div><p>Using <code>(( ... ))</code> makes sure that the values are integers, don’t have to use <code>$</code> and means you don’t have to use <code>-gt</code> or <code>-lt</code> in <code>[[ .. ]]</code>:<div class="sourceCode"id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"aria-hidden="true"></a><span class="kw">if</span> <span class="kw">((</span> some_var &gt; 3 <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb17-2"><a href="#cb17-2"aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3"aria-hidden="true"></a><span class="kw">fi</span></span></code></pre></div><p>Use an explicit <code>./</code> path when doing wildcard expansion of filenames:<div class="sourceCode"id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"aria-hidden="true"></a><span class="fu">find</span> . -name <span class="st">&quot;./*.txt&quot;</span></span></code></pre></div><p><strong>Don’t use <code>eval</code></strong>.<h3 id="arrays">Arrays</h3><p>Arrays should be used for lists of items, to avoid complications with quoting.<p>Using a single string to multiple command arguments to another command should be avoided, as it leads to having to either doing an eval or parameter expansion.<div class="sourceCode"id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"aria-hidden="true"></a><span class="co"># Do this:</span></span>
<span id="cb19-2"><a href="#cb19-2"aria-hidden="true"></a><span class="bu">declare</span> -a <span class="va">flags</span></span>
<span id="cb19-3"><a href="#cb19-3"aria-hidden="true"></a><span class="va">flags=(</span>--foo --bar<span class="va">=</span><span class="st">&#39;baz&#39;</span><span class="va">)</span></span>
<span id="cb19-4"><a href="#cb19-4"aria-hidden="true"></a><span class="va">flags+=(</span>--greeting<span class="va">=</span><span class="st">&quot;Hello </span><span class="va">${name}</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb19-5"><a href="#cb19-5"aria-hidden="true"></a><span class="ex">binary_command</span> <span class="st">&quot;</span><span class="va">${flags[@]}</span><span class="st">&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6"aria-hidden="true"></a><span class="co"># Instead of:</span></span>
<span id="cb19-7"><a href="#cb19-7"aria-hidden="true"></a><span class="va">flags=</span><span class="st">&#39;--foo --bar=baz&#39;</span></span>
<span id="cb19-8"><a href="#cb19-8"aria-hidden="true"></a><span class="va">flags+=</span><span class="st">&#39; --greeting=&quot;Hello world&quot;&#39;</span> # <span class="ex">not</span> trivial to do variable expansion</span>
<span id="cb19-9"><a href="#cb19-9"aria-hidden="true"></a><span class="ex">binary_command</span> <span class="st">&quot;</span><span class="va">${flags}</span><span class="st">&quot;</span></span></code></pre></div><p><code>"${flags[@]}"</code> expands the array properly into its properly quoted arguments. To demonstrate:<p><code>testarr</code>:<div class="sourceCode"id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"aria-hidden="true"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-2"><a href="#cb20-2"aria-hidden="true"></a><span class="bu">declare</span> -a <span class="va">arr</span></span>
<span id="cb20-3"><a href="#cb20-3"aria-hidden="true"></a><span class="va">arr=(</span><span class="st">&#39;1&#39;</span> <span class="st">&#39;2&#39;</span><span class="va">)</span></span>
<span id="cb20-4"><a href="#cb20-4"aria-hidden="true"></a><span class="va">arr+=(</span><span class="st">&quot;something&quot;</span> <span class="st">&#39;something else&#39;</span><span class="va">)</span></span>
<span id="cb20-5"><a href="#cb20-5"aria-hidden="true"></a><span class="ex">python3</span> ./testarr.py <span class="st">&quot;</span><span class="va">${arr[@]}</span><span class="st">&quot;</span></span></code></pre></div><p><code>testarr.py</code><div class="sourceCode"id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"aria-hidden="true"></a><span class="im">import</span> sys</span>
<span id="cb21-2"><a href="#cb21-2"aria-hidden="true"></a><span class="im">import</span> pprint</span>
<span id="cb21-3"><a href="#cb21-3"aria-hidden="true"></a></span>
<span id="cb21-4"><a href="#cb21-4"aria-hidden="true"></a>pprint.pprint(sys.argv)</span></code></pre></div><p>Output: <code>['./testarr.py', '1', '2', 'something', 'something else']</code><p>Command expansions return single strings, not arrays. Avoid trying to capture subshell into array assignments since it won’t work if the command contains special characters or whitespace. Better to read into a string and then use <code>readarray</code><h4 id="piping-to-while">Piping to While</h4><p>Use process substitution or <code>readarray</code> instead of directly piping into while. Pipes create subshells, so the block in the while loop doesn’t have access to un-exported variables in the script, and can’t change anything in the parent shell.<p><em>Don’t do this:</em><div class="sourceCode"id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"aria-hidden="true"></a><span class="va">my_variable=</span><span class="st">&#39;something&#39;</span></span>
<span id="cb22-2"><a href="#cb22-2"aria-hidden="true"></a><span class="bu">command</span> <span class="kw">|</span> <span class="kw">while</span> <span class="bu">read</span> -r <span class="va">line</span>; <span class="kw">do</span></span>
<span id="cb22-3"><a href="#cb22-3"aria-hidden="true"></a>  <span class="va">my_variable+=</span><span class="st">&quot;</span><span class="va">${line}</span><span class="st">\n&quot;</span></span>
<span id="cb22-4"><a href="#cb22-4"aria-hidden="true"></a><span class="kw">done</span></span>
<span id="cb22-5"><a href="#cb22-5"aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$my_variable</span><span class="st">&quot;</span>  # prints <span class="st">&#39;something&#39;</span>, wasnt modified in loop</span></code></pre></div><p><em>Do this instead:</em><div class="sourceCode"id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"aria-hidden="true"></a><span class="va">my_variable=</span><span class="st">&#39;something&#39;</span></span>
<span id="cb23-2"><a href="#cb23-2"aria-hidden="true"></a><span class="kw">while</span> <span class="bu">read</span> -r <span class="va">line</span>; <span class="kw">do</span></span>
<span id="cb23-3"><a href="#cb23-3"aria-hidden="true"></a>  <span class="va">my_variable+=</span><span class="st">&quot;</span><span class="va">${line}</span><span class="st">\n&quot;</span></span>
<span id="cb23-4"><a href="#cb23-4"aria-hidden="true"></a><span class="kw">done</span> <span class="op">&lt;</span> <span class="op">&lt;(</span><span class="bu">command</span><span class="op">)</span></span></code></pre></div><p>That leaves the while loop in the parent process, but still runs the command in a subshell.<p>You can also:<div class="sourceCode"id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1"aria-hidden="true"></a><span class="va">my_variable=</span><span class="st">&#39;something&#39;</span></span>
<span id="cb24-2"><a href="#cb24-2"aria-hidden="true"></a><span class="va">command_output=</span><span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb24-3"><a href="#cb24-3"aria-hidden="true"></a><span class="kw">while</span> <span class="bu">read</span> -r <span class="va">line</span>; <span class="kw">do</span></span>
<span id="cb24-4"><a href="#cb24-4"aria-hidden="true"></a>  <span class="va">my_variable+=</span><span class="st">&quot;</span><span class="va">${line}</span><span class="st">\n&quot;</span></span>
<span id="cb24-5"><a href="#cb24-5"aria-hidden="true"></a><span class="kw">done</span> <span class="op">&lt;&lt;&lt;</span><span class="st">&quot;</span><span class="va">$command_output</span><span class="st">&quot;</span></span></code></pre></div><p>… which sends the string into <code>STDIN</code>.<p>Another alternative with <code>readarray</code>:<div class="sourceCode"id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1"aria-hidden="true"></a><span class="va">my_variable=</span><span class="st">&#39;something&#39;</span></span>
<span id="cb25-2"><a href="#cb25-2"aria-hidden="true"></a><span class="ex">readarray</span> -t lines <span class="op">&lt;</span> <span class="op">&lt;(</span><span class="bu">command</span><span class="op">)</span></span>
<span id="cb25-3"><a href="#cb25-3"aria-hidden="true"></a><span class="kw">for</span> <span class="ex">line</span> in <span class="st">&quot;</span><span class="va">${lines[@]}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb25-4"><a href="#cb25-4"aria-hidden="true"></a>  <span class="va">my_variable+=</span><span class="st">&quot;</span><span class="va">${line}</span><span class="st">\n&quot;</span></span>
<span id="cb25-5"><a href="#cb25-5"aria-hidden="true"></a><span class="kw">done</span></span></code></pre></div><hr><p>Should be careful about using a for-loop to iterate over output using <code>for something in $(...)</code>, since the output is split by whitespace, not by line. This can be safe, if you’re sure the subshell output can’t contain whitespace, but <code>while</code> with <code>readarray</code> is often safer.<p><code>&lt;</code> and <code>&gt;</code> in <code>[[ ... ]]</code> perform <strong>lexicographic</strong>, not numerical comparisons.<h3 id="math-subshells">Math subshells:</h3><div class="sourceCode"id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"aria-hidden="true"></a><span class="co"># do some simple arithmetic and print it</span></span>
<span id="cb26-2"><a href="#cb26-2"aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$((</span> 2 + 2<span class="va">))</span><span class="st"> is 4&quot;</span></span>
<span id="cb26-3"><a href="#cb26-3"aria-hidden="true"></a><span class="co"># assign to variable</span></span>
<span id="cb26-4"><a href="#cb26-4"aria-hidden="true"></a><span class="kw">((</span> i = 10 * j + 400<span class="kw">))</span></span>
<span id="cb26-5"><a href="#cb26-5"aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$i</span><span class="st">&quot;</span></span></code></pre></div><p>In a math subshell, <code>0</code> is false and anything else is true. As an example to check external commands:<div class="sourceCode"id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"aria-hidden="true"></a><span class="va">COND=</span>1</span>
<span id="cb27-2"><a href="#cb27-2"aria-hidden="true"></a><span class="bu">command</span> -v <span class="st">&quot;command_name&quot;</span> <span class="op">&gt;</span>/dev/null <span class="kw">||</span> <span class="va">COND=</span>0</span>
<span id="cb27-3"><a href="#cb27-3"aria-hidden="true"></a><span class="bu">command</span> -v <span class="st">&quot;some_other_command&quot;</span> <span class="op">&gt;</span>/dev/null <span class="kw">||</span> <span class="va">COND=</span>0</span>
<span id="cb27-4"><a href="#cb27-4"aria-hidden="true"></a><span class="kw">if</span> <span class="kw">((</span>COND<span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb27-5"><a href="#cb27-5"aria-hidden="true"></a>    <span class="ex">command_name</span> <span class="st">&quot;something&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6"aria-hidden="true"></a>    <span class="ex">some_other_command</span> <span class="st">&quot;something&quot;</span></span>
<span id="cb27-7"><a href="#cb27-7"aria-hidden="true"></a><span class="kw">else</span></span>
<span id="cb27-8"><a href="#cb27-8"aria-hidden="true"></a>    <span class="bu">echo</span> <span class="st">&quot;you don&#39;t have command&quot;</span></span>
<span id="cb27-9"><a href="#cb27-9"aria-hidden="true"></a><span class="kw">fi</span></span></code></pre></div><p><code>let</code> isn’t <code>declare</code> or <code>local</code> - just avoid it.<p>Stylistic considerations aside, shell built-in arithmetic is way faster than a subshell out to <code>expr</code> - avoid it.<h3 id="localdeclare">Local/Declare</h3><p><code>local</code> and <code>declare</code> have the same flags. <code>declare</code> works a global level and <code>local</code> works in functions.<p>same thing:<div class="sourceCode"id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1"aria-hidden="true"></a><span class="bu">readonly</span> <span class="va">SOME_PATH=</span><span class="st">&#39;/some/path&#39;</span></span>
<span id="cb28-2"><a href="#cb28-2"aria-hidden="true"></a><span class="bu">declare</span> -r <span class="va">SOMEPATH=</span><span class="st">&#39;/some/path&#39;</span></span></code></pre></div><div class="sourceCode"id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1"aria-hidden="true"></a><span class="co"># makes constant and exports variable:</span></span>
<span id="cb29-2"><a href="#cb29-2"aria-hidden="true"></a><span class="bu">declare</span> -rx <span class="va">SOMEPATH=</span><span class="st">&#39;/some/path&#39;</span></span></code></pre></div><p>Can set a variable to be readonly after checking opts:<div class="sourceCode"id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1"aria-hidden="true"></a><span class="va">VERBOSE=</span><span class="st">&#39;false&#39;</span></span>
<span id="cb30-2"><a href="#cb30-2"aria-hidden="true"></a><span class="kw">while</span> <span class="bu">getopts</span> <span class="st">&#39;v&#39;</span> flag<span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb30-3"><a href="#cb30-3"aria-hidden="true"></a>  <span class="kw">case</span> <span class="st">&quot;</span><span class="va">${flag}</span><span class="st">&quot;</span><span class="kw"> in</span></span>
<span id="cb30-4"><a href="#cb30-4"aria-hidden="true"></a>    v<span class="kw">)</span> <span class="va">VERBOSE=</span><span class="st">&#39;true&#39;</span> <span class="kw">;;</span></span>
<span id="cb30-5"><a href="#cb30-5"aria-hidden="true"></a>  <span class="kw">esac</span></span>
<span id="cb30-6"><a href="#cb30-6"aria-hidden="true"></a><span class="kw">done</span></span>
<span id="cb30-7"><a href="#cb30-7"aria-hidden="true"></a><span class="bu">readonly</span> <span class="va">VERBOSE</span></span></code></pre></div><h3 id="clobbering-exit-codes">Clobbering Exit Codes</h3><p>You should separate the declaration of <code>declare</code> and <code>local</code> from its <code>RHS</code> value if that includes a call to a subshell which could fail. For example:<div class="sourceCode"id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1"aria-hidden="true"></a><span class="bu">declare</span> <span class="va">my_var=</span><span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb31-2"><a href="#cb31-2"aria-hidden="true"></a><span class="kw">((</span> <span class="va">$?</span> == 0 <span class="kw">))</span> <span class="kw">||</span> <span class="bu">return</span></span></code></pre></div><p>will <em>always</em> succeed, since the <code>declare</code> returns a 0 exit code.<p>Should instead do:<div class="sourceCode"id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1"aria-hidden="true"></a><span class="bu">declare</span> <span class="va">my_var</span></span>
<span id="cb32-2"><a href="#cb32-2"aria-hidden="true"></a><span class="va">my_var=</span><span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3"aria-hidden="true"></a><span class="kw">((</span> <span class="va">$?</span> == 0<span class="kw">))</span></span></code></pre></div><p>When a script gets large enough, you may start separating parts into functions. That means that an <code>exit</code> that may have previously existed wouldn’t exit the script, but instead the function. Those should be converted to <code>return</code> and then the main invocation to the function should be <code>||</code>’d or <code>(( $? == 0))</code>d against. This also leads itself well to exporting functions in <code>bash</code> for interactive use.<p>So, it makes more sense to create a <code>main</code> or top-level function that includes your entire script, like:<div class="sourceCode"id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1"aria-hidden="true"></a><span class="fu">main()</span> <span class="kw">{</span></span>
<span id="cb33-2"><a href="#cb33-2"aria-hidden="true"></a>  [ <span class="ex">-z</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> ] <span class="kw">&amp;&amp;</span> <span class="kw">{</span></span>
<span id="cb33-3"><a href="#cb33-3"aria-hidden="true"></a>    <span class="bu">echo</span> <span class="st">&quot;error&quot;</span> <span class="op">&gt;&amp;2</span></span>
<span id="cb33-4"><a href="#cb33-4"aria-hidden="true"></a>    <span class="bu">return</span> 1</span>
<span id="cb33-5"><a href="#cb33-5"aria-hidden="true"></a>  <span class="kw">}</span></span>
<span id="cb33-6"><a href="#cb33-6"aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb33-7"><a href="#cb33-7"aria-hidden="true"></a></span>
<span id="cb33-8"><a href="#cb33-8"aria-hidden="true"></a><span class="ex">main</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span> <span class="kw">||</span> <span class="bu">exit</span> <span class="va">$?</span></span></code></pre></div><p>For short scripts that just once from top to bottom, that’s slight overkill, but once you’re doing lots of <code>getopts</code>/<code>validation</code> or have a sufficient amount of functionality, it makes sense to do that.<h3 id="checking-return-values">Checking Return Values</h3><p>Instead of explicitly checking <code>$?</code> to check the error code, you can use an if statement, or just a <code>||</code> with curly brackets:<div class="sourceCode"id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1"aria-hidden="true"></a><span class="kw">if</span> ! <span class="fu">mv</span> <span class="st">&quot;</span><span class="va">$something</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$somewhere</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">then</span></span>
<span id="cb34-2"><a href="#cb34-2"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;Error, couldnt move </span><span class="va">${something}</span><span class="st">&quot;</span></span>
<span id="cb34-3"><a href="#cb34-3"aria-hidden="true"></a>  <span class="bu">exit</span> 1</span>
<span id="cb34-4"><a href="#cb34-4"aria-hidden="true"></a><span class="kw">fi</span></span>
<span id="cb34-5"><a href="#cb34-5"aria-hidden="true"></a></span>
<span id="cb34-6"><a href="#cb34-6"aria-hidden="true"></a><span class="co"># or...</span></span>
<span id="cb34-7"><a href="#cb34-7"aria-hidden="true"></a><span class="kw">if</span> ! <span class="va">some_error=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">mv</span> <span class="st">&quot;</span><span class="va">$something</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$somewhere</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span>; <span class="kw">then</span></span>
<span id="cb34-8"><a href="#cb34-8"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$some_error</span><span class="st">&quot;</span></span>
<span id="cb34-9"><a href="#cb34-9"aria-hidden="true"></a>  <span class="bu">exit</span> 1</span>
<span id="cb34-10"><a href="#cb34-10"aria-hidden="true"></a><span class="kw">fi</span></span>
<span id="cb34-11"><a href="#cb34-11"aria-hidden="true"></a></span>
<span id="cb34-12"><a href="#cb34-12"aria-hidden="true"></a><span class="co"># or...</span></span>
<span id="cb34-13"><a href="#cb34-13"aria-hidden="true"></a><span class="fu">mv</span> <span class="st">&quot;</span><span class="va">$something</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$somewhere</span><span class="st">&quot;</span> <span class="kw">||</span> <span class="kw">{</span></span>
<span id="cb34-14"><a href="#cb34-14"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;Error, couldn&#39;t move </span><span class="va">${something}</span><span class="st">&quot;</span></span>
<span id="cb34-15"><a href="#cb34-15"aria-hidden="true"></a>  <span class="bu">exit</span> 1</span>
<span id="cb34-16"><a href="#cb34-16"aria-hidden="true"></a><span class="kw">}</span></span></code></pre></div><p>Bash also has <code>PIPESTATUS</code> that lets you check the return code from every part of a pipe.<div class="sourceCode"id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1"aria-hidden="true"></a><span class="fu">tar</span> -cf - ./* <span class="kw">|</span> <span class="kw">(</span> <span class="bu">cd</span> <span class="st">&quot;</span><span class="va">${dir}</span><span class="st">&quot;</span> <span class="kw">&amp;&amp;</span> <span class="fu">tar</span> -xf - <span class="kw">)</span></span>
<span id="cb35-2"><a href="#cb35-2"aria-hidden="true"></a><span class="kw">if</span> <span class="kw">((</span> PIPESTATUS[0] != 0 || PIPESTATUS[1] != 0 <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb35-3"><a href="#cb35-3"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;Unable to tar files to </span><span class="va">${dir}</span><span class="st">&quot;</span> <span class="op">&gt;&amp;2</span></span>
<span id="cb35-4"><a href="#cb35-4"aria-hidden="true"></a><span class="kw">fi</span></span></code></pre></div><p>Another alternative if you’re pipelining text is to use <code>xargs -r</code>, which doesn’t run if the STDIN is empty, which is typically the case if a command failed:<div class="sourceCode"id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1"aria-hidden="true"></a><span class="ex">some_command_that_might_print_nothing</span> <span class="kw">|</span> <span class="fu">xargs</span> -r -I <span class="st">&quot;{}&quot;</span> echo <span class="st">&quot;{}&quot;</span></span></code></pre></div><p>Notes from: <a href="https://www.youtube.com/watch?v=uqHjc7hlqd0"class="uri">https://www.youtube.com/watch?v=uqHjc7hlqd0</a><p>For help: <code>type</code>, <code>help</code>, <code>apropos</code>, <code>man</code>, <code>info</code><p>Return value of the last command executed is captured in the special parameter <code>$?</code>.<h4 id="loops">loops</h4><p><code>while list1; do list2; done</code><p>Execute <code>list1</code>; if success, execute list2 and repeat. Continue until list1 returns a non-zero status (fails).<p><code>for name in words; do list; done</code><p>Can also use an arithmetic expression, with look like C-styled for loops:<p><code>for (( expr1; expr2; expr3 )); do list; done</code><p><code>select name in words; do list; done</code><p>Create a menu item for each word. Provide the user with an interactive interface to select one of them. Each time the user makes a selection from the menu, <code>name</code> is assigned the value of the selected word and <code>REPLY</code> is assigned the <code>index</code> number of the selection.<div class="sourceCode"id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1"aria-hidden="true"></a><span class="kw">select</span> <span class="ex">result</span> in Yes No Cancel Exit</span>
<span id="cb37-2"><a href="#cb37-2"aria-hidden="true"></a>    <span class="kw">do</span></span>
<span id="cb37-3"><a href="#cb37-3"aria-hidden="true"></a>        <span class="kw">if</span><span class="bu"> [</span> <span class="st">&quot;</span><span class="va">$result</span><span class="st">&quot;</span> <span class="ot">=</span> <span class="st">&quot;Exit&quot;</span><span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb37-4"><a href="#cb37-4"aria-hidden="true"></a>        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$result</span><span class="st">&quot;</span></span>
<span id="cb37-5"><a href="#cb37-5"aria-hidden="true"></a>        <span class="bu">exit</span> 0</span>
<span id="cb37-6"><a href="#cb37-6"aria-hidden="true"></a>        <span class="kw">fi</span></span>
<span id="cb37-7"><a href="#cb37-7"aria-hidden="true"></a>        <span class="bu">echo</span> <span class="va">$result</span></span>
<span id="cb37-8"><a href="#cb37-8"aria-hidden="true"></a>    <span class="kw">done</span></span></code></pre></div><p><code>[[ -t 0 ]]</code> can be used to check if <code>STDOUT</code> (file descriptor 0) refers to a terminal. It returns 0 if it is a terminal, and 1 if its being redirected input from some other command/file. This lets you choose to be interactive with the user, or assume some default value if its being called from a script.<h3 id="command-groups">Command Groups</h3><ul><li>Subshell: Evaluate list of commands in a subshell, has a distinct environment and does not affect the parent environment. <code>(list)</code><li>Group Command: Evaluate list of commands in the current shell, sharing the environment. <code>{ list; }</code> (spaces are trailing semicolon are obligatory)</ul><p>Something I never really comprehended, this is still a subshell, its just not assigning to some variable, so you don’t need to prepend the <code>$</code><p><code>(echo b; echo a) | sort</code><p>The <code>$(list)</code> replaces the output of the <code>list</code> in-line with the output of its subshell. Referred to as <em>command substitution</em>.<p><code>$$</code> is a special parameter that specifies your current PID.<h3 id="parameters">Parameters</h3><p>Like <code>${param:-$HOME}</code>, <code>${param:=$HOME}</code> returns <code>$HOME</code> if <code>${param}</code> is empty or unset, but it <em>also</em> sets <code>param</code> to <code>$HOME</code>, without you having to do the assignment explicitly.<p>Can think of these as:<p>Removal from left edge:<ul><li><code>${param#pattern}</code><li><code>${param##pattern}</code> ( greedy match )</ul><div class="sourceCode"id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1"aria-hidden="true"></a><span class="bu">[</span> ~<span class="bu"> ]</span> $ <span class="bu">echo</span> <span class="va">${HOME}</span></span>
<span id="cb38-2"><a href="#cb38-2"aria-hidden="true"></a><span class="ex">/home/sean</span></span>
<span id="cb38-3"><a href="#cb38-3"aria-hidden="true"></a><span class="bu">[</span> ~<span class="bu"> ]</span> $ <span class="bu">echo</span> <span class="va">${HOME#</span>*/<span class="va">}</span></span>
<span id="cb38-4"><a href="#cb38-4"aria-hidden="true"></a><span class="ex">home/sean</span></span>
<span id="cb38-5"><a href="#cb38-5"aria-hidden="true"></a><span class="bu">[</span> ~<span class="bu"> ]</span> $ <span class="bu">echo</span> <span class="va">${HOME##</span>*/<span class="va">}</span></span>
<span id="cb38-6"><a href="#cb38-6"aria-hidden="true"></a><span class="ex">sean</span></span></code></pre></div><p>Reminder that <code>*</code> is the typical posix globbing, its matching zero or more of any character (<code>.*</code> in PCRE terms)<p>Removal from right edge<ul><li><code>${param%pattern}</code><li><code>${param%%pattern}</code></ul><p>Can search the env for names matching something (this parameter expansion doesnt work in <code>zsh</code>):<div class="sourceCode"id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1"aria-hidden="true"></a>$ <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${!XDG_@}</span><span class="st">&quot;</span></span>
<span id="cb39-2"><a href="#cb39-2"aria-hidden="true"></a><span class="ex">XDG_CACHE_HOME</span> XDG_CONFIG_HOME XDG_CURRENT_DESKTOP XDG_DATA_HOME XDG_GREETER_DATA_DIR XDG_RUNTIME_DIR XDG_SEAT XDG_SEAT_PATH XDG_SESSION_CLASS XDG_SESSION_DESKTOP XDG_SESSION_ID XDG_SESSION_PATH XDG_SESSION_TYPE XDG_VTNR</span></code></pre></div><h3 id="brace-expansion">brace expansion</h3><div class="sourceCode"id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1"aria-hidden="true"></a>$ <span class="bu">echo</span> ba<span class="dt">{t,r}</span></span>
<span id="cb40-2"><a href="#cb40-2"aria-hidden="true"></a><span class="ex">bat</span> bar</span></code></pre></div><p>Can also use this to generate a cartesian product of any dimension:<div class="sourceCode"id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1"aria-hidden="true"></a>$ <span class="bu">echo</span> <span class="dt">{1..5}{0,5}</span>%</span>
<span id="cb41-2"><a href="#cb41-2"aria-hidden="true"></a><span class="ex">10%</span> 15% 20% 25% 30% 35% 40% 45% 50% 55%</span>
<span id="cb41-3"><a href="#cb41-3"aria-hidden="true"></a>$ <span class="bu">echo</span> <span class="dt">{10..55..5}</span>%  # can also use a iterator to count by 5</span>
<span id="cb41-4"><a href="#cb41-4"aria-hidden="true"></a><span class="ex">10%</span> 15% 20% 25% 30% 35% 40% 45% 50% 55%</span></code></pre></div><p>Functions receive input from STDIN, and send to STDOUT. The <code>{ }</code> is not required, its a Group Command, which often just makes things easier to read. For example:<div class="sourceCode"id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1"aria-hidden="true"></a><span class="fu">words ()</span></span>
<span id="cb42-2"><a href="#cb42-2"aria-hidden="true"></a><span class="kw">for</span> <span class="ex">word</span></span>
<span id="cb42-3"><a href="#cb42-3"aria-hidden="true"></a><span class="kw">do</span></span>
<span id="cb42-4"><a href="#cb42-4"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$word</span><span class="st">&quot;</span></span>
<span id="cb42-5"><a href="#cb42-5"aria-hidden="true"></a>  <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$word</span><span class="st">&quot;</span> <span class="op">&gt;&amp;2</span></span>
<span id="cb42-6"><a href="#cb42-6"aria-hidden="true"></a><span class="kw">done</span> <span class="op">2&gt;</span><span class="ex">/dev/null</span></span></code></pre></div><p>works fine, since the command there is the <code>for</code>.<p>A function definition is just a statement, so the <code>2&gt;/dev/null</code> means that when the function is called, all of the functions STDERR is ignored.<div class="sourceCode"id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1"aria-hidden="true"></a>$ <span class="ex">words</span> one two</span>
<span id="cb43-2"><a href="#cb43-2"aria-hidden="true"></a><span class="ex">one</span></span>
<span id="cb43-3"><a href="#cb43-3"aria-hidden="true"></a><span class="ex">two</span></span></code></pre></div><h2 id="session-portability">Session Portability</h2><p>Import elements from a current session directly into a new local or remote session.<div class="sourceCode"id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1"aria-hidden="true"></a><span class="fu">sudo</span> bash -c <span class="st">&quot;</span></span>
<span id="cb44-2"><a href="#cb44-2"aria-hidden="true"></a><span class="va">$(</span><span class="bu">declare</span> -p <span class="va">parameters</span>;</span>
<span id="cb44-3"><a href="#cb44-3"aria-hidden="true"></a><span class="bu">declare</span> -f <span class="va">functions)</span></span>
<span id="cb44-4"><a href="#cb44-4"aria-hidden="true"></a><span class="st">code and stuff&quot;</span></span></code></pre></div><p>… imports parameters and functions into the root shell, and then run <code>code and stuff</code><p>similarly, could use this with <code>ssh</code>:<div class="sourceCode"id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1"aria-hidden="true"></a><span class="fu">ssh</span> remote@host <span class="st">&quot;</span></span>
<span id="cb45-2"><a href="#cb45-2"aria-hidden="true"></a><span class="va">$(</span><span class="bu">declare</span> -f <span class="va">functionname)</span></span>
<span id="cb45-3"><a href="#cb45-3"aria-hidden="true"></a><span class="st">functionname arguments&quot;</span></span></code></pre></div><p>References:<ul><li><a href="https://google.github.io/styleguide/shellguide.html"class="uri">https://google.github.io/styleguide/shellguide.html</a><li>bash man page</ul></div></main><footer><p><a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode"id="copyright">© 2020 Sean Breckenridge. Licensed under Creative Commons Attribution-ShareAlike.</a><br><a href="https://github.com/seanbreckenridge/exobrain">Source Code</a></footer><script src="/assets/main.js"></script>